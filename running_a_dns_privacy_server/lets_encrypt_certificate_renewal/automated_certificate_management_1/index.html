<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.147.9">
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Certificate management Method 1 :: dnsprivacy.org</title>

    
    <link href="/css/nucleus.css?1752844954" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1752844954" rel="stylesheet">
    <link href="/css/hybrid.css?1752844954" rel="stylesheet">
    <link href="/css/featherlight.min.css?1752844954" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1752844954" rel="stylesheet">
    <link href="/css/auto-complete.css?1752844954" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1752844954" rel="stylesheet">
    <link href="/css/theme.css?1752844954" rel="stylesheet">
    <link href="/css/tabs.css?1752844954" rel="stylesheet">
    <link href="/css/hugo-theme.css?1752844954" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1752844954" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1752844954"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_1/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/'>
  <p style="color: #fafafa;font-size:34px;font-weight: 400; font-family:Helvetica Neue, arial, courier;"><strong>DNS Privacy Project</strong></p>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1752844954"></script>
<script type="text/javascript" src="/js/auto-complete.js?1752844954"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/dnsprivacy.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1752844954"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/the_problem/" title="The Problem" class="dd-item
        
        
        
        ">
      <a href="/the_problem/">
          1. The Problem
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/the_solutions/" title="The Solutions" class="dd-item
        
        
        
        ">
      <a href="/the_solutions/">
          2. The Solutions
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/current_work/" title="Current Work" class="dd-item
        
        
        
        ">
      <a href="/current_work/">
          3. Current Work
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ietf_dns_privacy_tutorial/" title="IETF DNS Privacy Tutorial" class="dd-item
        
        
        
        ">
      <a href="/ietf_dns_privacy_tutorial/">
          4. IETF DNS Privacy Tutorial
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/public_resolvers/" title="Public Resolvers" class="dd-item
        
        
        
        ">
      <a href="/public_resolvers/">
          5. Public Resolvers
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/test_servers/" title="Test Servers" class="dd-item
        
        
        
        ">
      <a href="/test_servers/">
          6. Test Servers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/test_servers/map_of_test_server_locations/" title="Map of test server locations" class="dd-item ">
        <a href="/test_servers/map_of_test_server_locations/">
        6.1. Map of test server locations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/test_servers/monitoring/" title="dnsprivacy Monitoring" class="dd-item ">
        <a href="/test_servers/monitoring/">
        6.2. dnsprivacy Monitoring
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/test_servers/live_traffic_levels/" title="Live Traffic Levels" class="dd-item ">
        <a href="/test_servers/live_traffic_levels/">
        6.2. Live Traffic Levels
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dns_privacy_clients/" title="DNS Privacy Clients" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_clients/">
          7. DNS Privacy Clients
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dns_privacy_daemon_-_stubby/" title="DNS Privacy Daemon - Stubby" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_daemon_-_stubby/">
          8. DNS Privacy Daemon - Stubby
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/about_stubby/" title="About Stubby" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/about_stubby/">
        8.1. About Stubby
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/configuring_stubby/" title="Configuring Stubby" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/configuring_stubby/">
        8.2. Configuring Stubby
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/stubby_manager_gui/" title="Stubby Manager GUI" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/stubby_manager_gui/">
        8.3. Stubby Manager GUI
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/" title="Installation" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_daemon_-_stubby/installation/">
          8.4. Installation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/linux_from_source/" title="Linux From Source" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/linux_from_source/">
        8.4.1. Linux From Source
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/running_as_a_service_on_nix/" title="Running as a service on *nix" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/running_as_a_service_on_nix/">
        8.4.2. Running as a service on *nix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/macos_homebrew/" title="MacOS Homebrew" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/macos_homebrew/">
        8.4.3. MacOS Homebrew
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/stubby_gui_for_macos/" title="Stubby GUI for macOS" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/stubby_gui_for_macos/">
        8.4.4. Stubby GUI for macOS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/windows_installer_for_stubby/" title="Windows installer for Stubby" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/windows_installer_for_stubby/">
        8.4.5. Windows installer for Stubby
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/implementation_status/" title="Implementation Status" class="dd-item
        
        
        
        ">
      <a href="/implementation_status/">
          9. Implementation Status
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/" title="Running a DNS Privacy server" class="dd-item
        parent
        
        
        ">
      <a href="/running_a_dns_privacy_server/">
          10. Running a DNS Privacy server
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_unbound/" title="Using Unbound" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_unbound/">
        10.1. Using Unbound
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_knot_resolver/" title="Using Knot Resolver" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_knot_resolver/">
        10.2. Using Knot Resolver
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_dnsdist/" title="Using dnsdist" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_dnsdist/">
        10.3. Using dnsdist
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/using_a_tls_proxy/" title="Using a TLS proxy" class="dd-item
        
        
        
        ">
      <a href="/running_a_dns_privacy_server/using_a_tls_proxy/">
          10.4. Using a TLS proxy
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_a_tls_proxy/building_haproxy_using_tlsv1_3/" title="Building HAProxy using TLSv1.3" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_a_tls_proxy/building_haproxy_using_tlsv1_3/">
        10.4.1. Building HAProxy using TLSv1.3
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/" title="Let&#39;s Encrypt Certificate renewal" class="dd-item
        parent
        
        
        ">
      <a href="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/">
          10.5. Let&#39;s Encrypt Certificate renewal
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_1/" title="Certificate management Method 1" class="dd-item active">
        <a href="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_1/">
        10.5.1. Certificate management Method 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_2/" title="Certificate management method 2" class="dd-item ">
        <a href="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_2/">
        10.5.2. Certificate management method 2
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/monitoring_privacy_servers/" title="Monitoring Privacy servers" class="dd-item ">
        <a href="/running_a_dns_privacy_server/monitoring_privacy_servers/">
        10.6. Monitoring Privacy servers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/best_current_practices/" title="Best Current Practices" class="dd-item
        
        
        
        ">
      <a href="/running_a_dns_privacy_server/best_current_practices/">
          10.7. Best Current Practices
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/best_current_practices/comparison_of_policy_and_privacy_statements_2019/" title="Comparison of policy and privacy statements 2019" class="dd-item ">
        <a href="/running_a_dns_privacy_server/best_current_practices/comparison_of_policy_and_privacy_statements_2019/">
        10.7.1. Comparison of policy and privacy statements 2019
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/best_current_practices/data_minimisation_of_dns_traffic/" title="Data minimisation of DNS traffic" class="dd-item ">
        <a href="/running_a_dns_privacy_server/best_current_practices/data_minimisation_of_dns_traffic/">
        10.7.2. Data minimisation of DNS traffic
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/encrypted-zone-transfer/" title="Encrypted Zone Transfer" class="dd-item
        
        
        
        ">
      <a href="/encrypted-zone-transfer/">
          11. Encrypted Zone Transfer
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dns_privacy_reference_material/" title="DNS Privacy Reference Material" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_reference_material/">
          12. DNS Privacy Reference Material
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/performance_measurements/" title="Performance Measurements" class="dd-item
        
        
        
        ">
      <a href="/performance_measurements/">
          13. Performance Measurements
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/performance_measurements/initial_performance_measurements_q1_2018/" title="Initial Performance Measurements (Q1 2018)" class="dd-item ">
        <a href="/performance_measurements/initial_performance_measurements_q1_2018/">
        12.1. Initial Performance Measurements (Q1 2018)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/performance_measurements/follow-up_performance_measurements_q4_2108/" title="Follow-Up Performance Measurements (Q4 2108)" class="dd-item ">
        <a href="/performance_measurements/follow-up_performance_measurements_q4_2108/">
        12.2. Follow-Up Performance Measurements (Q4 2108)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/performance_measurements/review_of_dns_and_http_pm_tools/" title="Review of DNS and HTTP PM Tools" class="dd-item ">
        <a href="/performance_measurements/review_of_dns_and_http_pm_tools/">
        12.3. Review of DNS and HTTP PM Tools
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/performance_measurements/proposal_for_new_performance_tool/" title="Proposal for New Performance Tool" class="dd-item ">
        <a href="/performance_measurements/proposal_for_new_performance_tool/">
        12.4. Proposal for New Performance Tool
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ndss_dns_privacy_workshop/" title="NDSS DNS Privacy Workshop" class="dd-item
        
        
        
        ">
      <a href="/ndss_dns_privacy_workshop/">
          14. NDSS DNS Privacy Workshop
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/" title="2021 NDSS DNS Privacy Workshop" class="dd-item
        
        
        
        ">
      <a href="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/">
          14.1. 2021 NDSS DNS Privacy Workshop
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/call_for_papers/" title="Call for Papers" class="dd-item ">
        <a href="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/call_for_papers/">
        14.1.1. Call for Papers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/" title="Workshop Notes" class="dd-item
        
        
        
        ">
      <a href="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/">
          14.1.2. Workshop Notes
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/breakout_room_1/" title="Zoom Breakout Room 1: Measurement of Encrypted DNS" class="dd-item ">
        <a href="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/breakout_room_1/">
        14.1.2.1. Zoom Breakout Room 1: Measurement of Encrypted DNS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/breakout_room_2/" title="Zoom Breakout Room 2: Civil Society, Usability and DNS" class="dd-item ">
        <a href="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/breakout_room_2/">
        14.1.2.2. Zoom Breakout Room 2: Civil Society, Usability and DNS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/breakout_room_3/" title="Zoom Breakout Room 3: Novel Work, ADoT and Future Research" class="dd-item ">
        <a href="/ndss_dns_privacy_workshop/2021_ndss_dns_privacy_workshop/workshop_notes/breakout_room_3/">
        14.1.2.3. Zoom Breakout Room 3: Novel Work, ADoT and Future Research
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ndss_dns_privacy_workshop/2018_ndss_dns_privacy_workshop/" title="2018 NDSS DNS Privacy Workshop" class="dd-item ">
        <a href="/ndss_dns_privacy_workshop/2018_ndss_dns_privacy_workshop/">
        14.2. 2018 NDSS DNS Privacy Workshop
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ndss_dns_privacy_workshop/2017_ndss_dns_privacy_workshop/" title="2017 NDSS DNS Privacy Workshop" class="dd-item ">
        <a href="/ndss_dns_privacy_workshop/2017_ndss_dns_privacy_workshop/">
        14.3. 2017 NDSS DNS Privacy Workshop
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/dnsprivacy"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.youtube.com/channel/UCaJWMY-m9ktZIbUNMi0Eh9g/playlists"><i class='fab fa-youtube'></i> YouTube</a>
              </li>
          
              <li>
                  <a class="padding" href="https://sinodun.com"><i class='fas fa-bookmark'></i> Sinodun IT</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.nlnetlabs.nl/"><i class='fas fa-bookmark'></i> NLnetLabs</a>
              </li>
          
              <li>
                  <a class="padding" href="http://dnsprivacy.org/ndss_dns_privacy_workshop"><i class='fas fa-bookmark'></i> NDSS DNS Privacy Workshop</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn">Hugo Theme Learn</a> and <a href="https://gohugo.io/">Hugo</a></p>
<p>Built by <a href="sinodun.com">Sinodun Internet Technologies.</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>DNS Privacy Project</a> > <a href='/running_a_dns_privacy_server/'>Running a DNS Privacy server</a> > <a href='/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/'>Let's Encrypt Certificate renewal</a> > Certificate management Method 1
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#dns-setup">DNS setup</a>
      <ul>
        <li><a href="#cnames">CNAMES</a></li>
      </ul>
    </li>
    <li><a href="#configure-dehydrated">Configure dehydrated</a>
      <ul>
        <li><a href="#create-a-domains-file">Create a domains file</a></li>
        <li><a href="#write-a-hook-script">Write a hook script</a></li>
      </ul>
    </li>
    <li><a href="#write-a-script-to-download-the-certificates-to-your-dns-servers">Write a script to download the certificates to your DNS servers</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Certificate management Method 1
            </h1>
          

        


<div class="toc">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#dns-setup">DNS setup</a>
      <ul>
        <li><a href="#cnames">CNAMES</a></li>
      </ul>
    </li>
    <li><a href="#configure-dehydrated">Configure dehydrated</a>
      <ul>
        <li><a href="#create-a-domains-file">Create a domains file</a></li>
        <li><a href="#write-a-hook-script">Write a hook script</a></li>
      </ul>
    </li>
    <li><a href="#write-a-script-to-download-the-certificates-to-your-dns-servers">Write a script to download the certificates to your DNS servers</a></li>
  </ul>
</nav>
</div>
<h2 id="background">Background</h2>
<p>At Sinodun we use
dehydrated <a href="https://github.com/lukas2511/dehydrated">https://github.com/lukas2511/dehydrated</a> to manage our
certificates. Also we use the <a href="https://tools.ietf.org/html/draft-ietf-acme-acme-09#section-8.5">dns-01
challenge</a> to
renew them.</p>
<p>Since we run multiple DNS-over-TLS servers, the method used here employs
a single &lsquo;certificate management&rsquo; server to renew the certificates,
update the zone with the dns-01 challenge and make the renewed
certificates available via ftp. A script is then run on each DNS server
to download any new certificates using ftp to each server and restart
the DNS service. In this example we use TLS proxies in front of BIND, or
Knot resolver.</p>
<h2 id="dns-setup">DNS setup</h2>
<p>You could put the dns-01 challenge responses in your organisations main
zone. However it is more flexible to dedicate a separate zone for that,
especially if you are responsible for running the servers but someone
else or some other organisation is responsible for the DNS.</p>
<p>For authoritative DNS we use knot <a href="https://www.knot-dns.cz/">https://www.knot-dns.cz/</a> because it
has a nice interface for managing zones. The same effect could be
obtained using dynamic updates.</p>
<p>It is a good idea to sign your zone if you are going to be putting
challenge response records in it. However, the nameserver must be able
to sign updates as they are applied.</p>
<h3 id="cnames">CNAMES</h3>
<p>Lets assume that we are managing certificates for two servers
dnsovertls1.&lt;YOURDOMAIN&gt;. and dnsovertls.&lt;YOURDOMAIN&gt;.</p>
<p>Add CNAME RRs to the &lt;YOURDOMAIN&gt; zone like these. These will redirect
queries for the dns-01 challenge to a dedicated zone which can exist on
and be served by a dedicated certificate management server</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>_acme-challenge.dnsovertls1.&lt;YOURDOMAIN&gt;. <span style="color:#ae81ff">300</span> CNAME dnsovertls1.&lt;YOURDOMAIN&gt;.acme.&lt;YOURDOMAIN&gt;.
</span></span><span style="display:flex;"><span>_acme-challenge.dnsovertls.&lt;YOURDOMAIN&gt;. <span style="color:#ae81ff">300</span> CNAME dnsovertls.&lt;YOURDOMAIN&gt;.acme.&lt;YOURDOMAIN&gt;.
</span></span></code></pre></div><p>Delegate acme.&lt;YOURDOMAIN&gt; to the certificate management server by
adding NS and DS RRs to the &lt;YOURDOMAIN&gt; zone. Lets assume the server
is called ns1.acme.&lt;YOURDOMAIN&gt;</p>
<p>Create an empty zone for acme.&lt;YOURDOMAIN&gt; (SOA and NS and A/AAAA RRs).
Configure knot to sign the domain</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">server:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen: &lt;YOURIP4&gt;@53</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen: &lt;YOURIP6&gt;@53</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">user: knot:knot</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">log:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">- target: syslog</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">any: info</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">policy:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">- id: dnssec</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">algorithm: ECDSAP256SHA256</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">zone:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">- domain: acme.&lt;YOURDOMAIN&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">file: &#34;acme.&lt;YOURDOMAIN&gt;.zone&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dnssec-signing: on</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dnssec-policy: dnssec</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>acme.&lt;YOURDOMAIN&gt;.       <span style="color:#ae81ff">3600</span>    SOA     ns1.acme.&lt;YOURDOMAIN&gt;. user.&lt;YOURDOMAIN&gt;. <span style="color:#ae81ff">2016120927</span> <span style="color:#ae81ff">30000</span> <span style="color:#ae81ff">300</span> <span style="color:#ae81ff">604800</span> <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>acme.&lt;YOURDOMAIN&gt;.       <span style="color:#ae81ff">3600</span>    NS      ns1.acme.&lt;YOURDOMAIN&gt;.
</span></span><span style="display:flex;"><span>ns1.acme.&lt;YOURDOMAIN&gt;.   <span style="color:#ae81ff">3600</span>    A       &lt;YOURIP4&gt;
</span></span><span style="display:flex;"><span>ns1.acme.&lt;YOURDOMAIN&gt;.   <span style="color:#ae81ff">3600</span>    AAAA    &lt;YOURIP6&gt;
</span></span></code></pre></div><h2 id="configure-dehydrated">Configure dehydrated</h2>
<p>Get dehydrated <a href="https://github.com/lukas2511/dehydrated">https://github.com/lukas2511/dehydrated</a> and create some
config.

<div class="notices infoblock" ><p>Uncomment the first two lines until you are sure everything is working.
This will allow you to run the scripts for debugging without exceeding
the production Let&rsquo;s Encrypt limits</p>
</div>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">## CA=&#34;https://acme-staging.api.letsencrypt.org/directory&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## CA_TERMS=&#34;https://acme-staging.api.letsencrypt.org/terms&#34;</span>
</span></span><span style="display:flex;"><span>LICENSE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf&#34;</span>
</span></span><span style="display:flex;"><span>CERTDIR<span style="color:#f92672">=</span>/&lt;PATH&gt;/dehydrated/certs
</span></span><span style="display:flex;"><span>DOMAINS_TXT<span style="color:#f92672">=</span>/&lt;PATH&gt;/dehydrated/dehydrated.domains
</span></span><span style="display:flex;"><span>CHALLENGETYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dns-01&#34;</span>
</span></span><span style="display:flex;"><span>HOOK<span style="color:#f92672">=</span>/&lt;PATH&gt;/dehydrated/hook.sh
</span></span><span style="display:flex;"><span>PRIVATE_KEY_RENEW<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>PRIVATE_KEY_ROLLOVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>CONTACT_EMAIL<span style="color:#f92672">=</span>you AT email
</span></span></code></pre></div><p>The two PRIVATE_KEY lines ensure that the key is not replaced and so
SPKI pinning will work.</p>
<h3 id="create-a-domains-file">Create a domains file</h3>
<p>Create a dehydrated.domains file
(<em>/&lt;PATH&gt;/dehydrated/dehydrated.domains</em>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dnsovertls.&lt;YOURDOMAIN&gt;
</span></span><span style="display:flex;"><span>dnsovertls1.&lt;YOURDOMAIN&gt;
</span></span></code></pre></div><h3 id="write-a-hook-script">Write a hook script</h3>
<p>Create a hook.sh script (<em>/&lt;PATH&gt;/dehydrated/hook.sh</em>). </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>set -e
</span></span><span style="display:flex;"><span>set -u
</span></span><span style="display:flex;"><span>set -o pipefail
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>check_knotc_exit_code<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! $1 -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    /usr/sbin/knotc zone-abort acme.&lt;YOURDOMAIN&gt;.
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy_challenge<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  local DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">.acme.&lt;YOURDOMAIN&gt;.&#34;</span> RDATA<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>3<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;ns1.acme.&lt;YOURDOMAIN&gt;&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_acme-challenge.</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Adding </span>$DOMAIN<span style="color:#e6db74"> 10 TXT \&#34;</span>$RDATA<span style="color:#e6db74">\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;zone-begin acme.&lt;YOURDOMAIN&gt;.&#34;</span>
</span></span><span style="display:flex;"><span>  /usr/sbin/knotc zone-begin acme.&lt;YOURDOMAIN&gt;.
</span></span><span style="display:flex;"><span>  check_knotc_exit_code $?
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;zone-set acme.&lt;YOURDOMAIN&gt;. </span>$DOMAIN<span style="color:#e6db74"> 10 TXT \&#34;</span>$RDATA<span style="color:#e6db74">\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  /usr/sbin/knotc zone-set acme.&lt;YOURDOMAIN&gt;. $DOMAIN <span style="color:#ae81ff">10</span> TXT <span style="color:#ae81ff">\&#34;</span>$RDATA<span style="color:#ae81ff">\&#34;</span>
</span></span><span style="display:flex;"><span>  check_knotc_exit_code $?
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;zone-commit acme.&lt;YOURDOMAIN&gt;.&#34;</span>
</span></span><span style="display:flex;"><span>  /usr/sbin/knotc zone-commit acme.&lt;YOURDOMAIN&gt;.
</span></span><span style="display:flex;"><span>  check_knotc_exit_code $?
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>clean_challenge<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   local DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">.acme.&lt;YOURDOMAIN&gt;.&#34;</span> RDATA<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>3<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;ns1.acme.&lt;YOURDOMAIN&gt;&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>     DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_acme-challenge.</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>   echo <span style="color:#e6db74">&#34;Removing </span>$DOMAIN<span style="color:#e6db74"> 10 TXT \&#34;</span>$RDATA<span style="color:#e6db74">\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>   echo <span style="color:#e6db74">&#34;zone-begin acme.&lt;YOURDOMAIN&gt;.&#34;</span>
</span></span><span style="display:flex;"><span>   /usr/sbin/knotc zone-begin acme.&lt;YOURDOMAIN&gt;.
</span></span><span style="display:flex;"><span>   check_knotc_exit_code $?
</span></span><span style="display:flex;"><span>   echo <span style="color:#e6db74">&#34;zone-unset acme.&lt;YOURDOMAIN&gt;. </span>$DOMAIN<span style="color:#e6db74"> 10 TXT \&#34;</span>$RDATA<span style="color:#e6db74">\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>   /usr/sbin/knotc zone-unset acme.&lt;YOURDOMAIN&gt;. $DOMAIN TXT
</span></span><span style="display:flex;"><span>   check_knotc_exit_code $?
</span></span><span style="display:flex;"><span>   echo <span style="color:#e6db74">&#34;zone-commit acme.&lt;YOURDOMAIN&gt;.&#34;</span>
</span></span><span style="display:flex;"><span>   /usr/sbin/knotc zone-commit acme.&lt;YOURDOMAIN&gt;.
</span></span><span style="display:flex;"><span>   check_knotc_exit_code $?
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>deploy_cert<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   local DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> KEYFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>2<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> CERTFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>3<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> FULLCHAINFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>4<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> CHAINFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>5<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> TIMESTAMP<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>6<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">## Copy cert files (not the keys) to your download site of choice - web, ftp etc...</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Deploying certs to ftp server&#34;</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Deploy for domain </span><span style="color:#e6db74">${</span>DOMAIN<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">${</span>CERTFILE<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span>FULLCHAINFILE<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span>CHAINFILE<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    cp <span style="color:#e6db74">${</span>CERTFILE<span style="color:#e6db74">}</span> /srv/ftp/certs/<span style="color:#e6db74">${</span>DOMAIN<span style="color:#e6db74">}</span>/
</span></span><span style="display:flex;"><span>    cp <span style="color:#e6db74">${</span>FULLCHAINFILE<span style="color:#e6db74">}</span> /srv/ftp/certs/<span style="color:#e6db74">${</span>DOMAIN<span style="color:#e6db74">}</span>/
</span></span><span style="display:flex;"><span>    cp <span style="color:#e6db74">${</span>CHAINFILE<span style="color:#e6db74">}</span> /srv/ftp/certs/<span style="color:#e6db74">${</span>DOMAIN<span style="color:#e6db74">}</span>/
</span></span><span style="display:flex;"><span>    chmod <span style="color:#ae81ff">644</span> /srv/ftp/certs/<span style="color:#e6db74">${</span>DOMAIN<span style="color:#e6db74">}</span>/*
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>unchanged_cert<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   local DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> KEYFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>2<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> CERTFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>3<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> FULLCHAINFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>4<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> CHAINFILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>5<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">## nothing yet..</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>startup_hook<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">## This hook is called before the cron command to do some initial tasks</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">## (e.g. starting a webserver).</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> i in <span style="color:#66d9ef">$(</span>awk <span style="color:#e6db74">&#39; { print $1 } &#39;</span> /&lt;PATH&gt;/dehydrated/dehydrated.domains <span style="color:#66d9ef">)</span> ; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>      CERTPATH<span style="color:#f92672">=</span>/srv/ftp/certs/$i
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! -d <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>         <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %a <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span> -ne <span style="color:#ae81ff">770</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>         <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %U <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;USER THE CERTS ARE CREATED BY&gt;&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>         <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %G <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ftp&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span> 
</span></span><span style="display:flex;"><span>           echo <span style="color:#e6db74">&#34;Creating, chmod, chown FTP directory for </span>$i<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>           mkdir -p <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>           chown &lt;USER THE CERTS ARE CREATED BY&gt;:ftp <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>           chmod <span style="color:#ae81ff">770</span> <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> i in <span style="color:#66d9ef">$(</span>cat /&lt;PATH&gt;/dehydrated/dehydrated.domains<span style="color:#66d9ef">)</span> ; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">## Now check that the zone owner has a CNAME pointing to us for this domain</span>
</span></span><span style="display:flex;"><span>      CNAME<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>dig _acme-challenge.$i CNAME +short<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> -z <span style="color:#e6db74">${</span>CNAME<span style="color:#e6db74">}</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;There is no CNAME pointing here for </span>$i<span style="color:#e6db74"> in the DNS&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>exit_hook<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">## This hook is called at the end of the cron command and can be used to</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">## do some final (cleanup or other) tasks.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  :
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>invalid_challenge<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    local DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> RESPONSE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>2<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## This hook is called if the challenge response has failed, so domain</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## owners can be aware and act accordingly.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## Parameters:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## - DOMAIN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">##   The primary domain name, i.e. the certificate common</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">##   name (CN).</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## - RESPONSE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">##   The response that the verification server returned</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>request_failure<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    local STATUSCODE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> REASON<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>2<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> REQTYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>3<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## This hook is called when an HTTP request fails (e.g., when the ACME</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## server is busy, returns an error, etc). It will be called upon any</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## response code that does not start with &#39;2&#39;. Useful to alert admins</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## about problems with requests.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## Parameters:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## - STATUSCODE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">##   The HTML status code that originated the error.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## - REASON</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">##   The specified reason for the error.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## - REQTYPE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">##   The kind of request that was made (GET, POST...)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HANDLER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>; shift
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HANDLER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span>~ ^<span style="color:#f92672">(</span>deploy_challenge|clean_challenge|deploy_cert|unchanged_cert|invalid_challenge|request_failure|startup_hook|exit_hook<span style="color:#f92672">)</span>$ <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;</span>$HANDLER<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><h2 id="write-a-script-to-download-the-certificates-to-your-dns-servers">Write a script to download the certificates to your DNS servers</h2>
<p>Do something like the following on each servers to download the
certificates from your main certificate server. </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>set -e
</span></span><span style="display:flex;"><span>set -u
</span></span><span style="display:flex;"><span>set -o pipefail
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>LOGNAME<span style="color:#e6db74">}</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Must be root. Exiting...&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## depending on what you are using to terminate the TLS connections</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## you might need to ensure the correct user can access the certificate files</span>
</span></span><span style="display:flex;"><span>SERVICEAPP<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;haproxy&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;knot-resolver&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  GROUPUSER<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;apache2&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>     <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;apache&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>     <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nginx&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  GROUPUSER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;www-data&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Unsupported service application. Exiting...&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CERTPATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/etc/certs&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! -d <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %a <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span> -ne <span style="color:#ae81ff">750</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %U <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %G <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">${</span>GROUPUSER<span style="color:#e6db74">}</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;No </span><span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#e6db74"> directory or permissions not good.&#34;</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Do something like:&#34;</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;  sudo mkdir -p </span><span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;  sudo chmod 750 </span><span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;  sudo chown root:</span><span style="color:#e6db74">${</span>GROUPUSER<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Exiting...&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! -f privkey.pem <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %a privkey.pem<span style="color:#66d9ef">)</span> -ne <span style="color:#ae81ff">640</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %U privkey.pem<span style="color:#66d9ef">)</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>stat -c %G <span style="color:#e6db74">${</span>CERTPATH<span style="color:#e6db74">}</span>/privkey.pem<span style="color:#66d9ef">)</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">${</span>GROUPUSER<span style="color:#e6db74">}</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> ! -s privkey.pem <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Private key not found or permissions not good. Exiting...&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## Use the hostname to figure out the cert CN</span>
</span></span><span style="display:flex;"><span>CN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>hostname -f<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;test1.dnsovertls.nl&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  CN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dnsovertls.&lt;YOURDOMAIN&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;test2.dnsovertls.nl&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  CN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dnsovertls1.&lt;YOURDOMAIN&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tar -cf backup-<span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span>.tar *.pem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -s --ssl-reqd --tlsv1 -O ftp://ns1.acme.&lt;YOURDOMAIN&gt;:21/certs/<span style="color:#e6db74">${</span>CN<span style="color:#e6db74">}</span>/cert.pem
</span></span><span style="display:flex;"><span>curl -s --ssl-reqd --tlsv1 -O ftp://ns1.acme.&lt;YOURDOMAIN&gt;:21/certs/<span style="color:#e6db74">${</span>CN<span style="color:#e6db74">}</span>/chain.pem
</span></span><span style="display:flex;"><span>curl -s --ssl-reqd --tlsv1 -O ftp://ns1.acme.&lt;YOURDOMAIN&gt;:21/certs/<span style="color:#e6db74">${</span>CN<span style="color:#e6db74">}</span>/fullchain.pem
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! -s cert.pem <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> ! -s chain.pem <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> ! -s fullchain.pem <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;At least one of the certificate files is empty or missing. Exiting...&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cat fullchain.pem &gt; keycert.pem
</span></span><span style="display:flex;"><span>cat privkey.pem &gt;&gt; keycert.pem
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">640</span> cert.pem chain.pem fullchain.pem keycert.pem
</span></span><span style="display:flex;"><span>chown root:<span style="color:#e6db74">${</span>GROUPUSER<span style="color:#e6db74">}</span> cert.pem chain.pem fullchain.pem keycert.pem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;haproxy&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;apache2&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nginx&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  INITNAME<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>SERVICEAPP<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;apache&#34;</span> <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  INITNAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;apache2&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Unsupported service application. Exiting...&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>systemctl reload-or-restart <span style="color:#e6db74">${</span>INITNAME<span style="color:#e6db74">}</span>
</span></span></code></pre></div>

<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1752844954"></script>
    <script src="/js/perfect-scrollbar.min.js?1752844954"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1752844954"></script>
    <script src="/js/jquery.sticky.js?1752844954"></script>
    <script src="/js/featherlight.min.js?1752844954"></script>
    <script src="/js/highlight.pack.js?1752844954"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1752844954"></script>
    <script src="/js/learn.js?1752844954"></script>
    <script src="/js/hugo-learn.js?1752844954"></script>
    
    

  </body>
</html>

